# Default region (UK)
REGION_PBF_URL=https://download.geofabrik.de/europe/united-kingdom-latest.osm.pbf


# Strict runtime defaults (live-first)
LIVE_RUNTIME_DATA_ENABLED=true
STRICT_LIVE_DATA_REQUIRED=true
LIVE_ROUTE_COMPUTE_REFRESH_MODE=route_compute
LIVE_ROUTE_COMPUTE_REQUIRE_ALL_EXPECTED=true
LIVE_ROUTE_COMPUTE_FORCE_NO_CACHE_HEADERS=true
LIVE_ROUTE_COMPUTE_PREFETCH_TIMEOUT_MS=300000
LIVE_ROUTE_COMPUTE_PREFETCH_MAX_CONCURRENCY=6
LIVE_ROUTE_COMPUTE_PROBE_TERRAIN=true
# In strict all_sources/full refresh, terrain probe is enforced even if this is set false.
LIVE_DATA_CACHE_TTL_S=120
# Bounded retry for transient live feed failures; strict mode still fails closed after retries.
LIVE_HTTP_MAX_ATTEMPTS=6
LIVE_HTTP_RETRY_DEADLINE_MS=30000
LIVE_HTTP_RETRY_BACKOFF_BASE_MS=200
LIVE_HTTP_RETRY_BACKOFF_MAX_MS=2500
LIVE_HTTP_RETRY_JITTER_MS=150
LIVE_HTTP_RETRY_RESPECT_RETRY_AFTER=true
LIVE_HTTP_RETRYABLE_STATUS_CODES=429,500,502,503,504
LIVE_SCENARIO_CACHE_TTL_SECONDS=120
ROUTE_CACHE_TTL_S=120
ROUTE_COMPUTE_ATTEMPT_TIMEOUT_S=1200
ROUTE_CONTEXT_PROBE_ENABLED=false
ROUTE_CONTEXT_PROBE_TIMEOUT_MS=2500
ROUTE_CONTEXT_PROBE_MAX_PATHS=2
ROUTE_CONTEXT_PROBE_MAX_STATE_BUDGET=15000
ROUTE_CONTEXT_PROBE_MAX_HOPS=320
ROUTE_GRAPH_WARMUP_ON_STARTUP=1
ROUTE_GRAPH_WARMUP_FAILFAST=1
ROUTE_GRAPH_WARMUP_TIMEOUT_S=1200
ROUTE_GRAPH_STATUS_CHECK_TIMEOUT_MS=1000
# Keep OD feasibility timeout separate from lightweight status checks.
ROUTE_GRAPH_OD_FEASIBILITY_TIMEOUT_MS=30000
ROUTE_GRAPH_PRECHECK_TIMEOUT_FAIL_CLOSED=false
ROUTE_GRAPH_MAX_STATE_BUDGET=600000
ROUTE_GRAPH_STATE_BUDGET_PER_HOP=1600
ROUTE_GRAPH_STATE_BUDGET_RETRY_MULTIPLIER=2.0
ROUTE_GRAPH_STATE_BUDGET_RETRY_CAP=2500000
ROUTE_GRAPH_STATE_SPACE_RESCUE_ENABLED=true
ROUTE_GRAPH_STATE_SPACE_RESCUE_MODE=reduced
ROUTE_GRAPH_SCENARIO_SEPARABILITY_FAIL=false
ROUTE_GRAPH_MIN_GIANT_COMPONENT_NODES=50000
ROUTE_GRAPH_MIN_GIANT_COMPONENT_RATIO=0.20
ROUTE_GRAPH_MAX_NEAREST_NODE_DISTANCE_M=10000
ROUTE_GRAPH_OD_CANDIDATE_LIMIT=2048
ROUTE_GRAPH_OD_CANDIDATE_MAX_RADIUS=12
ROUTE_GRAPH_MAX_HOPS=220
ROUTE_GRAPH_ADAPTIVE_HOPS_ENABLED=true
ROUTE_GRAPH_HOPS_PER_KM=18.0
ROUTE_GRAPH_HOPS_DETOUR_FACTOR=1.35
ROUTE_GRAPH_EDGE_LENGTH_ESTIMATE_M=30.0
ROUTE_GRAPH_HOPS_SAFETY_FACTOR=1.8
ROUTE_GRAPH_MAX_HOPS_CAP=6000

# Development-only route compute diagnostics (includes sensitive live-call details when enabled)
# WARNING: DEV_ROUTE_DEBUG_INCLUDE_SENSITIVE=true exposes auth headers/tokens in diagnostics.
DEV_ROUTE_DEBUG_CONSOLE_ENABLED=true
DEV_ROUTE_DEBUG_INCLUDE_SENSITIVE=true
DEV_ROUTE_DEBUG_MAX_CALLS_PER_REQUEST=4000
DEV_ROUTE_DEBUG_TRACE_TTL_SECONDS=3600
DEV_ROUTE_DEBUG_MAX_REQUEST_TRACES=256
DEV_ROUTE_DEBUG_RETURN_RAW_PAYLOADS=false
DEV_ROUTE_DEBUG_MAX_RAW_BODY_CHARS=2048

# Frontend compute attempt orchestration
COMPUTE_ATTEMPT_TIMEOUT_MS=1200000
COMPUTE_ROUTE_FALLBACK_TIMEOUT_MS=900000
NEXT_PUBLIC_COMPUTE_ATTEMPT_TIMEOUT_MS=1200000
NEXT_PUBLIC_COMPUTE_ROUTE_FALLBACK_TIMEOUT_MS=900000
NEXT_PUBLIC_COMPUTE_DEGRADE_STEPS=12,6,3
NEXT_PUBLIC_ROUTE_GRAPH_WARMUP_BASELINE_MS=900000

# Strict test bypass (keep disabled by default)
STRICT_RUNTIME_TEST_BYPASS=0
TERRAIN_DEM_FAIL_CLOSED_UK=true
TERRAIN_DEM_COVERAGE_MIN_UK=0.96

# Terrain live DEM (request-time)
LIVE_TERRAIN_DEM_URL_TEMPLATE=https://s3.amazonaws.com/elevation-tiles-prod/geotiff/{z}/{x}/{y}.tif
LIVE_TERRAIN_REQUIRE_URL_IN_STRICT=true
LIVE_TERRAIN_ALLOW_SIGNED_FALLBACK=false
LIVE_TERRAIN_ALLOWED_HOSTS=s3.amazonaws.com
LIVE_TERRAIN_TILE_ZOOM=8
LIVE_TERRAIN_TILE_MAX_AGE_DAYS=7
LIVE_TERRAIN_CACHE_DIR=
LIVE_TERRAIN_CACHE_MAX_TILES=1024
LIVE_TERRAIN_CACHE_MAX_MB=2048
LIVE_TERRAIN_FETCH_RETRIES=2
LIVE_TERRAIN_MAX_REMOTE_TILES_PER_ROUTE=96
LIVE_TERRAIN_CIRCUIT_BREAKER_FAILURES=8
LIVE_TERRAIN_CIRCUIT_BREAKER_COOLDOWN_S=30
LIVE_TERRAIN_ENABLE_IN_TESTS=false
LIVE_TERRAIN_PREFETCH_PROBE_FRACTIONS=0.5,0.35,0.65,0.2,0.8
LIVE_TERRAIN_PREFETCH_MIN_COVERED_POINTS=1

# Scenario live coefficients/context
# Contract endpoint required: must return scenario coefficient JSON in this repo's strict schema.
# There is no public drop-in UK API for this payload shape.
LIVE_SCENARIO_COEFFICIENT_URL=https://raw.githubusercontent.com/snaker938/whatif-freight-router/main/backend/assets/uk/scenario_profiles_uk.json
LIVE_SCENARIO_REQUIRE_URL_IN_STRICT=true
LIVE_SCENARIO_ALLOW_SIGNED_FALLBACK=false
LIVE_SCENARIO_ALLOWED_HOSTS=webtris.nationalhighways.co.uk,www.trafficengland.com,roadtraffic.dft.gov.uk,api.open-meteo.com,archive-api.open-meteo.com,raw.githubusercontent.com
LIVE_SCENARIO_DFT_MAX_PAGES=6
LIVE_SCENARIO_COEFFICIENT_MAX_AGE_MINUTES=4320
LIVE_SCENARIO_ALLOW_PARTIAL_SOURCES_STRICT=true
LIVE_SCENARIO_MIN_SOURCE_COUNT_STRICT=3
LIVE_SCENARIO_MIN_COVERAGE_OVERALL_STRICT=0.75
SCENARIO_MIN_OBSERVED_MODE_ROW_SHARE=0.20
SCENARIO_MAX_PROJECTION_DOMINANT_CONTEXT_SHARE=0.80

# Fuel live pricing
LIVE_FUEL_PRICE_URL=https://raw.githubusercontent.com/snaker938/whatif-freight-router/main/backend/assets/uk/fuel_prices_uk.json
LIVE_FUEL_AUTH_TOKEN=
LIVE_FUEL_API_KEY=
LIVE_FUEL_API_KEY_HEADER=X-API-Key
LIVE_FUEL_REQUIRE_URL_IN_STRICT=true
LIVE_FUEL_ALLOW_SIGNED_FALLBACK=false
LIVE_FUEL_REQUIRE_SIGNATURE=true
LIVE_FUEL_ALLOWED_HOSTS=raw.githubusercontent.com
LIVE_FUEL_MAX_AGE_DAYS=14

# Carbon live policy/intensity
LIVE_CARBON_SCHEDULE_URL=https://raw.githubusercontent.com/snaker938/whatif-freight-router/main/backend/assets/uk/carbon_price_schedule_uk.json
LIVE_CARBON_REQUIRE_URL_IN_STRICT=true
LIVE_CARBON_ALLOW_SIGNED_FALLBACK=false
LIVE_CARBON_ALLOWED_HOSTS=raw.githubusercontent.com
LIVE_BANK_HOLIDAYS_URL=https://www.gov.uk/bank-holidays.json
LIVE_BANK_HOLIDAYS_ALLOWED_HOSTS=www.gov.uk,gov.uk

# Departure, stochastic, toll live artifacts
LIVE_DEPARTURE_PROFILE_URL=https://raw.githubusercontent.com/snaker938/whatif-freight-router/main/backend/assets/uk/departure_profiles_uk.json
LIVE_DEPARTURE_REQUIRE_URL_IN_STRICT=true
LIVE_DEPARTURE_ALLOW_SIGNED_FALLBACK=false
LIVE_DEPARTURE_ALLOWED_HOSTS=raw.githubusercontent.com

LIVE_STOCHASTIC_REGIMES_URL=https://raw.githubusercontent.com/snaker938/whatif-freight-router/main/backend/assets/uk/stochastic_regimes_uk.json
LIVE_STOCHASTIC_REQUIRE_URL_IN_STRICT=true
LIVE_STOCHASTIC_ALLOW_SIGNED_FALLBACK=false
LIVE_STOCHASTIC_ALLOWED_HOSTS=raw.githubusercontent.com

LIVE_TOLL_TOPOLOGY_URL=https://raw.githubusercontent.com/snaker938/whatif-freight-router/main/backend/assets/uk/toll_topology_uk.json
LIVE_TOLL_TOPOLOGY_REQUIRE_URL_IN_STRICT=true
LIVE_TOLL_TOPOLOGY_ALLOW_SIGNED_FALLBACK=false

LIVE_TOLL_TARIFFS_URL=https://raw.githubusercontent.com/snaker938/whatif-freight-router/main/backend/assets/uk/toll_tariffs_uk.json
LIVE_TOLL_TARIFFS_REQUIRE_URL_IN_STRICT=true
LIVE_TOLL_TARIFFS_ALLOW_SIGNED_FALLBACK=false
LIVE_TOLL_ALLOWED_HOSTS=raw.githubusercontent.com
SCENARIO_REQUIRE_SIGNATURE=true
